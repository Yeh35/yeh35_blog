%{
title: "[if(kakao)2021] 카카오톡 서버의 스프링 공화국  fc1680e52cc84992a0ef7ee4df610dcb.md",
author: "yeh35",
tags: ~w(dev),
description: "",
published: false
}
---
# [if(kakao)2021] 카카오톡 서버의 스프링 공화국 탈출기 정리

게시: Yes
생성일자: 2022년 12월 6일 오후 7:40
수정일자: 2022년 12월 7일 오후 6:42
태그: Kotlin, Ktor, Spring

[if(kakao)2021](https://elseif.kakao.com/2021/session/49)

# Spring의 장점

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled.png)

- 저 연차부터 고연차까지 다양한 개발자
- 오랫동안 사용되서 구축된 다양한 라이브러리
- 오랬동안 장기간 지원

# Spring을 사용하지 않을 이유

## 1. 표준보다 관습

- 표준을 따르는 것은 다양한 언어간 연동을 편하게 해줌으로써 표준을 따르는 것이 좋다.
- Web 또한 시간이 지남에 따라 많은 부분이 변경되고 추가 되고 있다.
- 하지만 Spring은 오래된 프레임워크라서 표준의 변경 사항들을 따라가지 못하는 경우가 있고, Spring의 관습처럼 처리되는 경우가 많다.

### 사례 : Http 인증

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%201.png)

- 인증의 시작이 서버가 클라이언트에 인증 요청을 보내는 것으로 봤는데
- 표준에서는 **인증이 필요한 클라이언트 요청에 `시도`하는 것**으로 시작된다.
    - 즉, **서버가 특정 방식으로 인증 요구하는 것**으로 인증이 시작된다.
- `시도`는 RFC7235에 45번이나 언급될 정도로 중요한 사항이다.

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%202.png)

- 하지만 Spring Security에서는 `시도`에 대한 언급이 전혀 없고, 인증이 실패 했을 때 `시도`에 대한 처리가 하나도 없고 예외를 던지는 것으로 처리한다.

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%203.png)

- Ktor에서는 `challenge`라는 함수를 통해서 지원하는 인증 종류, 실패 사유, 실패 후 동작들을 받아서 처리할 수 있도록 되어 있다.
- Ktor에서는 `시도` 개념을 채용했다.

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%204.png)

- (추측) 둘이 다른 이유는 RFC 7235 표준이 나오기전에 Spring Security가 나왔고, Ktor는 표준이 출시된 이후에 나왔다.

## 2. 전이되는 의존성

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%205.png)

- 많은 곳에서 사용되다보니 많은 곳에서 Spring을 기본적인 의존성으로 가져온다.
- 사용되는 곳이 많은 라이브러리는 다양한 버전의 의존성을 Application이 가져가게 된다.

## 3. 우리는 Spring 개발자인가? Kotlin 개발자인가?

- 현실에서 Kotlin이 없는 경우 Java 로 대체하면 되지만 Spring이 없는 경우는 경험해보지 못했다.

# Spring의 혜택들

<aside>
📌 새로운 프레임 워크를 선택할 때 고려사항

</aside>

1. Dependency Injection
    
    ![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%206.png)
    
2. Database Integration
    
    ![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%207.png)
    
    - 데이터 베이스 연동 및 커넥션, 트렌젝션 관리 등등..
3. Interceptor와 Filter
    
    ![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%208.png)
    
    - 톡서버는 모든 요청들은 기본적으로 인증, 로깅, 지표등의 처리 이후에 비지니스 로직을 처리하도록 되어 있다.
    - 이를 위해서 AOP나 Spring에서 제공하는 다른 기능을 사용할 수 있지만, 명시적인 처리를 위해서 Interceptor와 Filter를 적극적으로 활용하고 있다.
    
     
    

# Ktor

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%209.png)

- `Dependency Injection` 같은 기능도 기본으로 제공하는 것이 아닌 개발자가 원하는데로 구성할 수 있다.

## 1. 라우팅 처리

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2010.png)

- 어노테이션에 의존하지 않는 모습이 단순하게 느껴진다.

## 2. Dependency Injection

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2011.png)

- Koin은 Kotlin을 위한 의존성 주입 라이브러리

### Spring의 복잡한 Bean 생성 라이프사이클

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2012.png)

### 인스턴스 생성 비교

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2013.png)

- Annotation 기반의 Spring
- DSL 형식의 Koin

## Database Integration

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2014.png)

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2015.png)

- Spring에서 DSL 방식을 사용하려면 QueryDsl이라는 추가적인 라이브러리를 사용해야 하지만 Exposed를 사용하면 자체적으로 DSL 문법과 코루틴도 지원한다.

## Interceptor와 Filter

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2016.png)

- Ktor에서 Pipeline을 통해서 Spring의 Interceptor와 Filter 기능을 제공한다.

### Spring에서 Interceptor와 Filter

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2017.png)

- Spring에서는 요청을 처리하는 구간이 정해져 있어서 해당 구간에서 요청사항을 처리한다.

### Ktor에서 기본 Pipeline

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2018.png)

- Application이 HTTP 요청을 처리하기 위해 사용하는 기본 Pipeline
- 페이지는 5단계로 구성되어 있다.
- 기존 파이프라인에 추가로 페이지를 구성할 수 있다.
- Ktor에서 제공하는 기본 인증을 사용하는 경우
    
    ![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2019.png)
    
    - Authenticate와 challenge 페이지가 추가된다.
    

# 탈출 후기

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2020.png)

- Spring은 완성된 그림 같았다.
- Spring에서 탈출하자 다양한 그림을 볼 수 있게 되었다.

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2021.png)

<aside>
📌 중요한 것은 Spring을 탈출하는 것이 아니다.

![Untitled](%5Bif(kakao)2021%5D%20%E1%84%8F%E1%85%A1%E1%84%8F%E1%85%A1%E1%84%8B%E1%85%A9%E1%84%90%E1%85%A9%E1%86%A8%20%E1%84%89%E1%85%A5%E1%84%87%E1%85%A5%E1%84%8B%E1%85%B4%20%E1%84%89%E1%85%B3%E1%84%91%E1%85%B3%E1%84%85%E1%85%B5%E1%86%BC%20%E1%84%80%E1%85%A9%E1%86%BC%E1%84%92%E1%85%AA%E1%84%80%E1%85%AE%E1%86%A8%20%20fc1680e52cc84992a0ef7ee4df610dcb/Untitled%2022.png)

</aside>